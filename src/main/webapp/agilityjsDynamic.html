<!DOCTYPE html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en-US" dir="ltr"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en-US" dir="ltr"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en-US" dir="ltr"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en-US" dir="ltr"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en-US" dir="ltr"> <!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Cache-Control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta http-equiv="cleartype" content="on" />
<link rel="shortcut icon" href="images/favicon.ico" />

<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css" />
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/tables.css" />
<!--[if lte IE 8]>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-old-ie-min.css" />
<![endif]-->
<!--[if gt IE 8]><!-->
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/grids-responsive-min.css" />
<!--<![endif]-->

<!--[if lt IE 9]>
<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.js"></script>
<![endif]-->

<!--[if lte IE 8]>
<link rel="stylesheet" href="css/jax-rs_static-old-ie-1.0.0-min.css" />
<![endif]-->
<!--[if gt IE 8]><!-->
<link rel="stylesheet" href="css/jax-rs_static-1.0.0-min.css" />
<!--<![endif]-->
<title>Dynamic Content with agilityjs</title>
</head>
<body class="pure-g">
<header class="pure-u-1">
<h2>Dynamic Content with agilityjs</h2>
</header>
<article class="pure-u-1 pure-u-md-1-5 pure-menu pure-menu-open jaxrs-static-menu">
<a href="#" class="pure-menu-heading">Select Feature</a>
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="deviceDetection.html">Device Detection</a></li>
<li class="pure-menu-selected"><a href="#">Dynamic Content with agilityjs</a></li>
<li><a href="angularDynamic.html">Dynamic Content with angular</a></li>
<li><a href="canjsDynamic.html">Dynamic Content with canjs</a></li>
<li><a href="emberDynamic.html">Dynamic Content with ember</a></li>
<li><a href="knockbackDynamic.html">Dynamic Content with knockback</a></li>
<li><a href="knockoutjsDynamic.html">Dynamic Content with knockoutjs</a></li>
<li><a href="spinejsDynamic.html">Dynamic Content with spinejs</a></li>
</ul>
</article>
<section class="pure-u-1 pure-u-md-4-5 jaxrs-static-content">

<div hidden="hidden">http://agilityjs.com/</div>

<div class="pure-u-1 pure-table jaxrs-static-table">
  <div class="pure-u-1 jaxrs-static-caption">Product</div>
	<div class="pure-g jaxrs-static-table-header">
	  <div class="pure-u-1 pure-u-md-3-24"><span>Code</span></div>
    <div class="pure-u-1 pure-u-md-10-24"><span>Description</span></div>
    <div class="pure-u-1 pure-u-md-3-24"><span>Color</span></div>
    <div class="pure-u-1 pure-u-md-3-24"><span>Cost</span></div>
    <div class="pure-u-1 pure-u-md-3-24"><span>Quantity</span></div>
    <div class="pure-u-1 pure-u-md-2-24"><span style="font-weight: normal;"><a id="add" href="javascript:void(0);">Add</a></span></div>
	</div>
  <div id="jaxrs-static-table-body" class="jaxrs-static-table-body"></div>
</div>

</section>

<div id="jaxrs-static-template" hidden="hidden">
  <div class="pure-g jaxrs-static-table-row">
    <div class="pure-u-1 pure-u-md-3-24"><span class="jaxrs-static-table-label">Code:</span>
      <span data-bind="code"></span>
      <div hidden="hidden"><input type="text" data-bind="code" /></div></div>
    <div class="pure-u-1 pure-u-md-10-24"><span class="jaxrs-static-table-label">Description:</span>
      <span data-bind="description"></span>
      <div hidden="hidden"><input type="text" data-bind="description" /></div></div>
    <div class="pure-u-1 pure-u-md-3-24"><span class="jaxrs-static-table-label">Color:</span>
      <span data-bind="color"></span>
      <div hidden="hidden"><input type="text" data-bind="color" /></div></div>
    <div class="pure-u-1 pure-u-md-3-24"><span class="jaxrs-static-table-label">Cost:</span>
      <span data-bind="cost"></span>
      <div hidden="hidden"><input type="text" step=".01" data-bind="cost" /></div></div>
    <div class="pure-u-1 pure-u-md-3-24"><span class="jaxrs-static-table-label">Quantity:</span>
      <span data-bind="quantity"></span>
      <div hidden="hidden"><input type="text" step=".01" data-bind="quantity" /></div></div>
    <div class="pure-u-1 pure-u-md-2-24"><span>
      <span class="edit"><a href="javascript:void(0);" class="edit">Edit</a></span>
      <span class="delete"><a href="javascript:void(0);" class="delete">Delete</a></span>
      <span class="save" hidden="hidden"><a href="javascript:void(0);" class="save">Save</a></span>
      <span class="cancel" hidden="hidden"><a href="javascript:void(0);" class="cancel">Cancel</a></span>
    </span></div>
  </div>
</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="js/agility-0.1.3.min.js"></script>
<script type="text/javascript" src="js/productResource-1.0.0-min.js"></script>
<script type="text/javascript">
var product = $$({
  model: {
    id: 0,
    code: '',
    description: '',
    color: '',
    cost: 0.0,
    quantity: 0.0
  },
  view: {
    format: $('#jaxrs-static-template').html()
  },
  controller: {
    'create': function(){
      this.view.$().find('input:eq(3)').attr('type', 'number');
      this.view.$().find('input:eq(4)').attr('type', 'number');
    },
    'click a.delete': function(){
      var answer = confirm('Do you really want to delete this product?');
      if (!answer) {
        return;
      }
      var parent = this.parent();
      var productId = _getId(this);
      this.destroy();
      parent.updateView();
      if (productId > 0) {
        productResourceDelete(productId, null);
      }
    },
    'click a.edit': function(){
      _toggleLinks(this.view.$().children(':last').find(':first'));
      this.view.$().children().each(function() {
        if ($(this).children().length !== 3) {
          return;
        }
        $(this).children(':eq(1)').attr('hidden', 'hidden');
        $(this).children(':eq(2)').attr('hidden', null);
      });
      this.view.$().find('input:first').focus();
      this.backupProduct = {};
      this.backupProduct.code = _getCode(this);
      this.backupProduct.description = _getDescription(this);
      this.backupProduct.color = _getColor(this);
      this.backupProduct.cost = _getCost(this);
      this.backupProduct.quantity = _getQuantity(this);
    },
    'click a.save': function(){
      _toggleLinks(this.view.$().children(':last').find(':first'));
      this.view.$().children().each(function() {
        if ($(this).children().length !== 3) {
          return;
        }
        $(this).children(':eq(1)').attr('hidden', null);
        $(this).children(':eq(2)').attr('hidden', 'hidden');
      });
      var productThis = this;
      productResourcePost(_getId(productThis),
          _getCode(productThis),
          _getDescription(productThis),
          _getColor(productThis),
          _getCost(productThis),
          _getQuantity(productThis),
          function(ajaxResults) {
        if (!ajaxResults || (ajaxResults === null)) {
          return;
        }
        productThis.model.set({
          id: ajaxResults.id, 
          code: ajaxResults.code, 
          description: ajaxResults.description, 
          color: ajaxResults.color, 
          cost: ajaxResults.cost, 
          quantity: ajaxResults.quantity 
        });
      });
    },
    'click a.cancel': function(){
      if (_getId(this) <= 0) {
        var parent = this.parent();
        this.destroy();
        parent.updateView();
        return;
      }
      _toggleLinks(this.view.$().children(':last').find(':first'));
      this.view.$().children().each(function() {
        if ($(this).children().length !== 3) {
          return;
        }
        $(this).children(':eq(1)').attr('hidden', null);
        $(this).children(':eq(2)').attr('hidden', 'hidden');
      });
      this.model.set({
        code: this.backupProduct.code, 
        description: this.backupProduct.description, 
        color: this.backupProduct.color, 
        cost: this.backupProduct.cost, 
        quantity: this.backupProduct.quantity 
      });
    }      
  }
});
productResourceList(function(ajaxResults) {
  if (!ajaxResults || (ajaxResults === null)) {
    return;
  }
  var $productResourceList = $(ajaxResults);
  var $products = $$({
    updateView: function(){
      var productsThis = this;
      var index = 1;
      productsThis.each(function() {
        this.view.$().removeClass('jaxrs-static-table-row-odd jaxrs-static-table-row-last');
        if (index % 2 !== 0) {
          this.view.$().addClass('jaxrs-static-table-row-odd');
        }
        if (index === productsThis.size()) {
          this.view.$().addClass('jaxrs-static-table-row-last');
        }
        index++;
      });
    },
    model: {},
    view: {},
    controller: {
      'create': function(){
        var productsThis = this;
        $productResourceList.each(function() {
          var prod = $$(product, this);
          productsThis.append(prod);
        });
        productsThis.updateView();
      }
    }
  }); 
  $$.document.append($products, '#jaxrs-static-table-body');
  $('#add').on('click', function() {
    var prod = $$(product);
    $products.append(prod);
    $products.updateView();
    prod.view.$().children(':last').find(':first span.edit a').click();
  });
});
function _getId(rowObj) {
  var id = rowObj.model.get('id');
  if (id !== null) {
    try {
      return parseInt(id.toString());
    } catch(e) {}
  }
  return 0;
}
function _getCode(rowObj) {
  var code = rowObj.model.get('code');
  if (code === null) {
    return '';
  }
  return code.toString();
}
function _getDescription(rowObj) {
  var description = rowObj.model.get('description');
  if (description === null) {
    return '';
  }
  return description.toString();
}
function _getColor(rowObj) {
  var color = rowObj.model.get('color');
  if (color === null) {
    return '';
  }
  return color.toString();
}
function _getCost(rowObj) {
  var cost = rowObj.model.get('cost');
  if (cost !== null) {
    try {
      return parseFloat(cost.toString());
    } catch(e) {}
  }
  return 0.0;
}
function _getQuantity(rowObj) {
  var quantity = rowObj.model.get('quantity');
  if (quantity !== null) {
    try {
      return parseFloat(quantity.toString());
    } catch(e) {}
  }
  return 0.0;
}
function _toggleLinks($linksParent) {
  if ($linksParent.find('span.edit').attr('hidden') === 'hidden') {
    $linksParent.find('span.edit').attr('hidden', null);
    $linksParent.find('span.delete').attr('hidden', null);
    $linksParent.find('span.save').attr('hidden', 'hidden');
    $linksParent.find('span.cancel').attr('hidden', 'hidden');
  } else {
    $linksParent.find('span.edit').attr('hidden', 'hidden');
    $linksParent.find('span.delete').attr('hidden', 'hidden');
    $linksParent.find('span.save').attr('hidden', null);
    $linksParent.find('span.cancel').attr('hidden', null);
  }
}
</script>

</body>
</html>